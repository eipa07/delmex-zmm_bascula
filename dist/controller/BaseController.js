sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageBox"],(e,t,o)=>{"use strict";return e.extend("delmex.zmmbascula.controller.BaseController",{onInit(){console.log("base controller")},getRouter:function(){return sap.ui.core.UIComponent.getRouterFor(this)},goBack:function(){var e=sap.ui.core.routing.History.getInstance().getPreviousHash();if(e!==undefined&&!e.includes("header")){history.go(-1)}else{var t=true;this.getRouter().navTo("RouteMain")}},getRequestModel(){let e=new t({Folio:"",CentroEnt:"",Tipoticket:"",CentroSal:"",Material:"",NumeroDoc:"",Placa:"",FechaEntBas:"",FechaSalBas:""});return e},getCatalogsModel(){let e=new t({Proceso:{1:"Entrada de Mercancía",2:"Salida de Mercancía",3:"Traslados de Mercancía",4:"Venta de Chatarra",5:"Serv de pesaje externo",6:"Otros"},TipoTicket:{1:"Ticket interno",2:"Ticket externo"}});return e},detailSettingsModel(){let e=new t({flag_oc:false,flag_ov:false});return e},getResourceBundle:function(){return this.getOwnerComponent().getModel("i18n").getResourceBundle()},_fetchCsrfToken:function(e){return new Promise((t,o)=>{$.ajax({url:e,method:"GET",headers:{"X-CSRF-Token":"Fetch",Accept:"application/json"},success:function(e,a,r){let n=r.getResponseHeader("X-CSRF-Token");if(n){t(n)}else{o("No se recibió el token CSRF.")}},error:o})})},get_JSON_PDF(){return{Structure:{Header:{Line1:"TICKET DE BASCULA",Line2:"LIBRAMIENTO SALTILLO - LAREDO #4030 GENERAL ESCOBEDO,",Line3:"N.L. C,P, 66072",Line4:"TEL: (81) 4057 5110",Line5:"WWW.DELMEX.MX",Line6:"",Line7:"",Line8:""},Body:{Folio:"FOLIO ",Placa:"PLACA ",Bound:"BOUND ",Fecha_Hora_SALIDA_1:"FECHA Y HORA ",Fecha_Hora_ENTRADA_1:"FECHA Y HORA ",Bruto:"BRUTO ",Called_Neto:"CALLED NETO ",Fecha_Hora_SALIDA_2:"DE SALIDA ",Fecha_Hora_ENTRADA_2:"DE ENTRADA "},Footer:{Nombre:"NOMBRE ",Referencia_Material:"REFERENCIA DE MATERIAL ",No_Doc:"NO. DE DOCUMENTO "},Helpers:{Line:"___________________________"}}}},buildDate(e){let t=parseInt(e.getMonth())+1;t=t<=9?"0"+t.toString():t.toString();let o=parseInt(e.getDate());o=o<=9?"0"+o.toString():o.toString();let a=e.getFullYear().toString()+t.toString()+o;return a},_getServiceUrl:function(){const e=sap.ui.require.toUrl("delmex/zmmbascula");const t=e.split("/webapp")[0];return t+"/sap/opu/odata/sap/ZUI_BASCULA_SRV_V2"},loadFolioData:function(e,t=false){const a=this;const r=this.getView().getModel("zbasc");const n=`/Folio('${e}')`;sap.ui.core.BusyIndicator.show();return new Promise(function(e,i){r.read(n,{success:function(o){const r=new sap.ui.model.json.JSONModel;r.setData(o);if(a.getView().getModel("basculaDetails")){a.getView().getModel("basculaDetails").setData()}a.getView().setModel(r,"basculaDetails");debugger;if(t){a.buildPDF(a)}sap.ui.core.BusyIndicator.hide();e(o)},error:function(e){sap.ui.core.BusyIndicator.hide();o.error("Error al obtener el folio.");i(e)}})})},buildPDF:function(e){var t=new jsPDF;var o=e.getView().getModel("pdfStructureModel").getData().Structure;e.getView().getModel("basculaDetails").refresh();var a=e.getView().getModel("basculaDetails").getData();const r=t.internal.pageSize.getWidth();const n=90;const i=30;const s=(r-n)/2;const c=10;var l=10;var d=12;t.setFontSize(l);const u=t.getTextWidth(o.Header.Line1);const g=(r-u)/2;const _=t.getTextWidth(o.Header.Line2);const m=(r-_)/2;const x=t.getTextWidth(o.Header.Line3);const L=(r-x)/2;const h=t.getTextWidth(o.Header.Line4);const p=(r-h)/2;const f=t.getTextWidth(o.Header.Line5);const D=(r-f)/2;const A=t.getTextWidth(o.Header.Line6);const F=(r-A)/2;const H=t.getTextWidth(o.Header.Line7);const B=(r-H)/2;var E=o.Body.Folio+a.Folio;const S=sap.ui.require.toUrl("delmex/zmmbascula/images/Logo.png");e.loadImageAsBase64(S,function(l){t.addImage(l,"PNG",s,20,n,i);t.setTextColor(7,31,99);t.setFont("helvetica","bolditalic");t.text(o.Header.Line1,g,70);t.text(o.Header.Line2,m,75);t.text(o.Header.Line3,L,80);t.text(o.Header.Line4,p,85);t.text(o.Header.Line5,D,90);t.setFontSize(d);t.text(E,r-(c+40),115,{align:"right"});const u=20;var _=o.Body.Placa;var x=o.Body.Bruto;var h=o.Body.Bound;var f=o.Body.Fecha_Hora_ENTRADA_1;var A=o.Body.Fecha_Hora_SALIDA_1;var F=o.Body.Bruto;var H=o.Body.Called_Neto;var B=o.Body.Fecha_Hora_ENTRADA_2;var S=o.Body.Fecha_Hora_SALIDA_2;a.Pesaje=e.formatter.formatNumberWithCommas(a.Pesaje.trim());a.Pesaje2=e.formatter.formatNumberWithCommas(a.Pesaje2.trim());a.PesoNeto=e.formatter.formatNumberWithCommas(a.PesoNeto.trim());t.setFont("helvetica","italic");t.text(_,u,140);t.text(a.Placa,u+30,140);t.text(o.Helpers.Line,u+30,141);t.text(x,u,150);t.text(h,u,155);t.text(a.Pesaje.trim(),u+30,155);t.text(o.Helpers.Line,u+30,156);var v=e.formatter.formatDate(a.FechaEntBas);var N=e.formatter.formatDate(a.FechaSalBas);t.text(f,u,165);t.text(B,u,170);t.text(v,60,170);t.text(o.Helpers.Line,u+40,171);t.text(_,u,185);t.text(a.Placa.trim(),u+30,185);t.text(o.Helpers.Line,u+30,186);t.text(F,u,200);t.text(a.Pesaje2.trim(),u+30,200);t.text(o.Helpers.Line,u+30,201);t.text(H,u,215);t.text(a.PesoNeto.trim(),u+40,215);t.text(o.Helpers.Line,u+40,216);t.text(A,u,225);t.text(S,u,230);t.text(N,60,230);t.text(o.Helpers.Line,u+40,231);var T=o.Footer.Nombre;var R=o.Footer.Referencia_Material;var C=o.Footer.No_Doc;t.text(T,u,250);t.text(a.Conductor,60,250);t.text(o.Helpers.Line,u+40,251);t.text(_,u,260);t.text(a.Placa.trim(),60,260);t.text(o.Helpers.Line,u+40,261);t.text(R.trim(),u,270);t.text(a.Material.trim(),90,270);t.text(o.Helpers.Line,90,271);t.text(C.trim(),u,280);t.text(a.NumeroDoc.trim(),u+50,280);t.text(o.Helpers.Line,u+50,281);const M=t.output("blob");const b=URL.createObjectURL(M);e._pdfViewer.setSource(b);e._pdfViewer.open()}.bind(e))},loadImageAsBase64:function(e,t){var o=new Image;o.onload=function(){var e=document.createElement("canvas");e.width=o.width;e.height=o.height;var a=e.getContext("2d");a.drawImage(o,0,0);var r=e.toDataURL("image/png");t(r)};o.src=e}})});
//# sourceMappingURL=BaseController.js.map