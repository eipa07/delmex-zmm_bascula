sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageBox"],(e,t,o)=>{"use strict";return e.extend("delmex.zmmbascula.controller.BaseController",{onInit(){console.log("base controller")},getRouter:function(){return sap.ui.core.UIComponent.getRouterFor(this)},goBack:function(){var e=sap.ui.core.routing.History.getInstance().getPreviousHash();if(e!==undefined&&!e.includes("header")){history.go(-1)}else{var t=true;this.getRouter().navTo("RouteMain")}},getRequestModel(){let e=new t({Folio:"",CentroEnt:"",Tipoticket:"",CentroSal:"",Material:"",NumeroDoc:"",Placa:"",FechaEntBas:"",FechaSalBas:""});return e},getCatalogsModel(){let e=new t({Proceso:{1:"Entrada de Mercancía",2:"Salida de Mercancía",3:"Traslados de Mercancía",4:"Venta de Chatarra",5:"Serv de pesaje externo",6:"Otros"},TipoTicket:{1:"Ticket interno",2:"Ticket externo"}});return e},detailSettingsModel(){let e=new t({flag_oc:false,flag_ov:false});return e},getResourceBundle:function(){return this.getOwnerComponent().getModel("i18n").getResourceBundle()},_fetchCsrfToken:function(e){return new Promise((t,o)=>{$.ajax({url:e,method:"GET",headers:{"X-CSRF-Token":"Fetch",Accept:"application/json"},success:function(e,r,a){let n=a.getResponseHeader("X-CSRF-Token");if(n){t(n)}else{o("No se recibió el token CSRF.")}},error:o})})},get_JSON_PDF(){return{Structure:{Header:{Line1:"AV. ÁNGEL MARTÍNEZ VILLAREAL #637 INT. S2",Line2:"COL. CHEPEVERA C.P. 64030 MONTERREY N. L. MÉXICO",Line3:"RFC GDE091112HA8",Line4:"LIBRAMIENTO NOROESTE # 4030, PARQUE INDUSTRIAL ESCOBEDO",Line5:"GENERAL ESCOBEDO, N.L. C.P. 66072",Line6:"TEL: (81) 4057 5110",Line7:"E-MAIL: CALIDAD@DELMEX.MX CREDITOS@DELMEX.MX",Line8:"WWW.DELMEX.MX"},Body:{Folio:"FOLIO ",Placa:"PLACA ",Bound:"BOUND ",Fecha_Hora_SALIDA_1:"FECHA Y HORA ",Bruto:"BRUTO ",Called_Neto:"CALLED NETO ",Fecha_Hora_SALIDA_2:"DE SALIDA "},Footer:{Nombre:"NOMBRE ",Referencia_Material:"REFERENCIA DE MATERIAL ",No_Doc:"NO. DE DOCUMENTO "},Helpers:{Line:"___________________________"}}}},buildDate(e){let t=parseInt(e.getMonth())+1;t=t<=9?"0"+t.toString():t.toString();let o=parseInt(e.getDate());o=o<=9?"0"+o.toString():o.toString();let r=e.getFullYear().toString()+t.toString()+o;return r},_getServiceUrl:function(){const e=sap.ui.require.toUrl("delmex/zmmbascula");const t=e.split("/webapp")[0];return t+"/sap/opu/odata/sap/ZUI_BASCULA_SRV_V2"},loadFolioData:function(e,t=false){const r=this;const a=this.getView().getModel("zbasc");const n=`/Folio('${e}')`;sap.ui.core.BusyIndicator.show();return new Promise(function(e,i){a.read(n,{success:function(o){const a=new sap.ui.model.json.JSONModel;a.setData(o);if(r.getView().getModel("basculaDetails")){r.getView().getModel("basculaDetails").setData()}r.getView().setModel(a,"basculaDetails");debugger;if(t){r.buildPDF(r)}sap.ui.core.BusyIndicator.hide();e(o)},error:function(e){sap.ui.core.BusyIndicator.hide();o.error("Error al obtener el folio.");i(e)}})})},buildPDF:function(e){var t=new jsPDF;var o=e.getView().getModel("pdfStructureModel").getData().Structure;e.getView().getModel("basculaDetails").refresh();var r=e.getView().getModel("basculaDetails").getData();const a=t.internal.pageSize.getWidth();const n=90;const i=30;const s=(a-n)/2;const c=10;var l=10;var d=12;t.setFontSize(l);const u=t.getTextWidth(o.Header.Line1);const g=(a-u)/2;const L=t.getTextWidth(o.Header.Line2);const x=(a-L)/2;const m=t.getTextWidth(o.Header.Line3);const _=(a-m)/2;const p=t.getTextWidth(o.Header.Line4);const E=(a-p)/2;const h=t.getTextWidth(o.Header.Line5);const D=(a-h)/2;const f=t.getTextWidth(o.Header.Line6);const H=(a-f)/2;const M=t.getTextWidth(o.Header.Line7);const S=(a-M)/2;var A=o.Body.Folio+r.Folio;const C=sap.ui.require.toUrl("delmex/zmmbascula/images/Logo.png");e.loadImageAsBase64(C,function(l){t.addImage(l,"PNG",s,20,n,i);t.setTextColor(7,31,99);t.setFont("helvetica","bolditalic");t.text(o.Header.Line1,g,70);t.text(o.Header.Line2,x,75);t.text(o.Header.Line3,_,80);t.text(o.Header.Line4,E,85);t.text(o.Header.Line5,D,90);t.text(o.Header.Line6,H,95);t.text(o.Header.Line7,S,100);t.setFontSize(d);t.text(A,a-(c+40),115,{align:"right"});const u=20;var L=o.Body.Placa;var m=o.Body.Bruto;var p=o.Body.Bound;var h=o.Body.Fecha_Hora_SALIDA_1;var f=o.Body.Bruto;var M=o.Body.Called_Neto;var C=o.Body.Fecha_Hora_SALIDA_2;r.Pesaje=e.formatter.formatNumberWithCommas(r.Pesaje.trim());r.Pesaje2=e.formatter.formatNumberWithCommas(r.Pesaje2.trim());r.PesoNeto=e.formatter.formatNumberWithCommas(r.PesoNeto.trim());t.setFont("helvetica","italic");t.text(L,u,140);t.text(r.Placa,u+30,140);t.text(o.Helpers.Line,u+30,141);t.text(m,u,150);t.text(p,u,155);t.text(r.Pesaje.trim(),u+30,155);t.text(o.Helpers.Line,u+30,156);var F=e.formatter.formatDate(r.FechaEntBas);t.text(h,u,165);t.text(C,u,170);t.text(F,60,170);t.text(o.Helpers.Line,u+40,171);t.text(L,u,185);t.text(r.Placa.trim(),u+30,185);t.text(o.Helpers.Line,u+30,186);t.text(f,u,200);t.text(r.Pesaje2.trim(),u+30,200);t.text(o.Helpers.Line,u+30,201);t.text(M,u,215);t.text(r.PesoNeto.trim(),u+40,215);t.text(o.Helpers.Line,u+40,216);t.text(h,u,225);t.text(C,u,230);t.text(F,60,230);t.text(o.Helpers.Line,u+40,231);var N=o.Footer.Nombre;var R=o.Footer.Referencia_Material;var B=o.Footer.No_Doc;t.text(N,u,250);t.text(r.Conductor,60,250);t.text(o.Helpers.Line,u+40,251);t.text(L,u,260);t.text(r.Placa.trim(),60,260);t.text(o.Helpers.Line,u+40,261);t.text(R.trim(),u,270);t.text(r.Material.trim(),90,270);t.text(o.Helpers.Line,90,271);t.text(B.trim(),u,280);t.text(r.NumeroDoc.trim(),u+50,280);t.text(o.Helpers.Line,u+50,281);const v=t.output("blob");const I=URL.createObjectURL(v);e._pdfViewer.setSource(I);e._pdfViewer.open()}.bind(e))},loadImageAsBase64:function(e,t){var o=new Image;o.onload=function(){var e=document.createElement("canvas");e.width=o.width;e.height=o.height;var r=e.getContext("2d");r.drawImage(o,0,0);var a=e.toDataURL("image/png");t(a)};o.src=e}})});
//# sourceMappingURL=BaseController.js.map