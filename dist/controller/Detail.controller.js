sap.ui.define(["delmex/zmmbascula/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox","sap/m/PDFViewer","delmex/zmmbascula/util/formatter","sap/ui/core/BusyIndicator"],(e,t,a,o,s,i,r,l)=>{"use strict";return e.extend("delmex.zmmbascula.controller.Detail",{formatter:r,onInit(){let e=this.getCatalogsModel();this.getView().setModel(e,"catalogsModel");sap.ui.getCore().setModel(e,"catalogsModel");var t=this.getRouter();t.getRoute("RouteDetail").attachMatched(this._onObjectMatched,this);this._pdfViewer=new i({title:"Vista previa del PDF"});this.getView().addDependent(this._pdfViewer);var a=new sap.ui.model.json.JSONModel;let o=this.get_JSON_PDF();a.setData(o);this.getView().setModel(a,"pdfStructureModel");let s=this.detailSettingsModel();this.getView().setModel(s,"settingsModel")},_onObjectMatched:async function(e){const t=e.getParameter("arguments").folio;try{const e=await this.loadFolioData(t)}catch(e){console.error("Fallo al cargar el folio:",e)}},goBackBtn(){this.goBack()},onShowPDF:function(){var e=this.getView().getModel("basculaDetails").getData();const t=true;this.loadFolioData(e.Folio,t)},loadImageAsBase64:function(e,t){var a=new Image;a.onload=function(){var e=document.createElement("canvas");e.width=a.width;e.height=a.height;var o=e.getContext("2d");o.drawImage(a,0,0);var s=e.toDataURL("image/png");t(s)};a.src=e},onUpdateData:async function(){debugger;const e=this.getView().getModel("zbasc");const t=this.getView().getModel("basculaDetails");const a=t?.getData()?.Folio;const o=this.getView().byId("txt_NumeroDoc").getValue();if(!a||!o){sap.m.MessageBox.warning(this.getResourceBundle().getText("message.folio_oc_requeridos"));return}const s=`/Alta('${a}')`;const i=e.sServiceUrl+s;const r={NumeroDoc:o};try{const t=this._getServiceUrl()+"/Folio('0')";const s=await this._fetchCsrfToken(t);await $.ajax({url:i,method:"PATCH",headers:{"X-CSRF-Token":s,"Content-Type":"application/json",Accept:"application/json"},data:JSON.stringify({NumeroDoc:o}),success:()=>{sap.m.MessageToast.show(this.getResourceBundle().getText("message.actualizacion_exitosa"));e.refresh(true);this.loadFolioData(a,false)},error:(e,t)=>{let a=e.responseJSON.error.message.value;sap.m.MessageBox.error(a)}})}catch(e){MessageToast.show("‚ùå Error obteniendo CSRF Token:",e)}}})});
//# sourceMappingURL=Detail.controller.js.map